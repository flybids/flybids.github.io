<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="flybid&apos;s blog">
<meta name="keywords" content="blog,博客,html,css,js,前端">
<meta property="og:type" content="website">
<meta property="og:title" content="Redo">
<meta property="og:url" content="https://flybids.github.io/index.html">
<meta property="og:site_name" content="Redo">
<meta property="og:description" content="flybid&apos;s blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redo">
<meta name="twitter:description" content="flybid&apos;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://flybids.github.io/">





  <title>Redo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Redo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">flybid's blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2020/06/05/Javascript中常见的设计模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/05/Javascript中常见的设计模式/" itemprop="url">JS中常见的设计模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-05T22:53:10+08:00">
                2020-06-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="设计模式的定义"><a href="#设计模式的定义" class="headerlink" title="设计模式的定义"></a>设计模式的定义</h2><ul>
<li><p>设计模式是<strong>前人总结出的，用于解决开发中某类问题的方法，可复用的解决方案</strong>；</p>
</li>
<li><p>我们在过去的开发中已经接触过设计模式，但当时可能不清楚这就是设计模式；</p>
</li>
<li><p>设计模式之间并不是互相独立的，往往一个功能需要多个设计模式的配合来实现；</p>
</li>
<li><p>每个设计模式面向的问题不同，根据这些模式的侧重点我们可以将其分成三大类：创建型设计模式、结构型设计模式、行为设计模式。当然，除了这三种外，还有其他未包含在内的设计模式。</p>
</li>
</ul>
<h2 id="设计模式的好处"><a href="#设计模式的好处" class="headerlink" title="设计模式的好处"></a>设计模式的好处</h2><ul>
<li>属于已经验证的一种解决方案</li>
<li>复用率高</li>
<li>更加具有表现力，方便沟通，描述解决方案</li>
</ul>
<h2 id="创建型设计模式"><a href="#创建型设计模式" class="headerlink" title="创建型设计模式"></a>创建型设计模式</h2><p>创建型设计模式： 主要用于创建对象，即不同场景下采用不同的方式来创建对象。主要包括单例模式、工厂模式、建造者模式以及原型模式等。</p>
<h4 id="1-单例模式"><a href="#1-单例模式" class="headerlink" title="1. 单例模式"></a>1. 单例模式</h4><p>单例模式（Singleton）：确保一个类只有一个实例。</p>
<ul>
<li>场景1</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    以完成一个弹窗的情景来理解</span></span><br><span class="line"><span class="comment">    封装一个弹窗，确保可以多次调用该弹窗</span></span><br><span class="line"><span class="comment">    为避免每次调用都新建一个弹窗，我们可以让所有的弹窗共用一个div元素</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span> Popup = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">Popup.show = <span class="function"><span class="keyword">function</span> (<span class="params">arg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.innerText = arg;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>)</span><br><span class="line">&#125;;</span><br><span class="line">Popup.show(<span class="string">"张三"</span>);<span class="comment">//测试使用1</span></span><br><span class="line">Popup.show(<span class="string">"李四"</span>);<span class="comment">//测试使用2</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    抽象化，写成类的形式：</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">let</span> Popup = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pop</span></span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>()&#123;</span><br><span class="line">            <span class="keyword">if</span>( instance )&#123;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">            instance = <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">this</span>.ele = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">            <span class="keyword">this</span>.show = <span class="function"><span class="keyword">function</span> (<span class="params">arg</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.ele.innerText = arg;</span><br><span class="line">                <span class="built_in">document</span>.body.appendChild(<span class="keyword">this</span>.ele);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Pop;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Popup();</span><br><span class="line">a.show(<span class="string">"张三"</span>);<span class="comment">//测试使用1</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> Popup();</span><br><span class="line">b.show(<span class="string">"李四"</span>);<span class="comment">//测试使用2</span></span><br><span class="line"><span class="built_in">console</span>.log(a === b);<span class="comment">//测试单例</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//核心实现代码</span></span><br><span class="line"><span class="keyword">let</span> Single = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">S</span></span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>()&#123;</span><br><span class="line">            <span class="keyword">if</span>(instance)&#123;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">            instance = <span class="keyword">this</span>;</span><br><span class="line">            <span class="comment">//code……</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="comment">//实例化测试</span></span><br><span class="line"><span class="built_in">console</span>.log( <span class="keyword">new</span> Single() === <span class="keyword">new</span> Single() );</span><br></pre></td></tr></table></figure>
<ul>
<li>场景2</li>
</ul>
<p>当我们直接使用字面量来定义一个对象时，该对象时唯一的，此时也可以看作单例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Single = &#123;</span><br><span class="line">    <span class="comment">//code        </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>将需要用到的相关的属性或方法全部放到某对象里面，减少了对全局变量的占用，也方便使用。此外，在多人协作开发的场景下，还可以避免命名冲突的问题。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> name = <span class="string">'Kate'</span>;</span><br><span class="line"><span class="keyword">let</span> eat = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上几个变量可以统一放在一个对象里面</span></span><br><span class="line"><span class="keyword">let</span> AMan = &#123;</span><br><span class="line">    age : <span class="number">10</span>,</span><br><span class="line">    name : <span class="string">'Kate'</span>,</span><br><span class="line">    eat()&#123;</span><br><span class="line">        <span class="comment">//code</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有些时候我们希望隐藏某些变量，只有内部能访问：</span></span><br><span class="line"><span class="keyword">let</span> AObj = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> NUM = <span class="number">10</span>;<span class="comment">// 内部私有属性</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        addNum()&#123;</span><br><span class="line">            <span class="keyword">return</span> ++NUM;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="built_in">console</span>.log( AObj.NUM ); <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log( AObj.addNum() ); <span class="comment">// 11</span></span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>当需求实例唯一、命名空间时，就可以使用单例模式。</p>
<h4 id="2-工厂模式"><a href="#2-工厂模式" class="headerlink" title="2. 工厂模式"></a>2. 工厂模式</h4><p>工厂模式（Factory）：通过一个统一的接口来创建指定的对象。工厂模式又包括 <em>简单工厂模式</em> 、<em>抽象工厂模式</em>和<em>工厂方法模式</em>两种。</p>
<ul>
<li>场景1</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//牛排店</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Steak</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//烧烤店</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grill</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">15</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//面条店</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noodles</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Steak(); <span class="comment">//一份牛排</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> Grill(); <span class="comment">//一份烧烤</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> Noodles(); <span class="comment">//一份面条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//三个类结构相似，写和调用比较繁琐、重复：</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//牛排</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Steak</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//烧烤</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grill</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">15</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//面条</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noodles</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//把三个类统一到一个类Shop里面</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shop</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">let</span> o = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">switch</span>(name)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"Steak"</span>:</span><br><span class="line">                o = <span class="keyword">new</span> Steak();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"Grill"</span>:</span><br><span class="line">                o = <span class="keyword">new</span> Grill();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"Noodles"</span>:</span><br><span class="line">                o = <span class="keyword">new</span> Noodles();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//统一方法调用</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Shop(<span class="string">"Steak"</span>); <span class="comment">//老板来份牛排</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> Shop(<span class="string">"Grill"</span>);<span class="comment">//老板来份烧烤</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> Shop(<span class="string">"Noodles"</span>);<span class="comment">//老板来份面条</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口已经统一，但是如果想要增加新品种菜，我们就需要再创建一个类，然后再Shop里面调用，扩展性低，所以可以将菜品类写成Shop的方法，此时只有一个Shop类：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shop</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[name].call(&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    Steak()&#123;<span class="comment">//牛排</span></span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Grill()&#123;<span class="comment">//烧烤</span></span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Noodles()&#123;<span class="comment">//面条</span></span><br><span class="line">        <span class="keyword">this</span>.price = <span class="number">15</span>;</span><br><span class="line">        <span class="keyword">this</span>.time = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//统一方法调用</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Shop(<span class="string">"Steak"</span>); <span class="comment">//老板来份牛排</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> Shop(<span class="string">"Grill"</span>);<span class="comment">//老板来份烧烤</span></span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> Shop(<span class="string">"Noodles"</span>);<span class="comment">//老板来份面条</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//需要扩展时，仅需再Shop中增加新的方法</span></span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>工厂模式就是把同一类别的类综合起来，通过统一接口创建，扩展性以及可修改性高。</p>
<h4 id="3-建造者模式"><a href="#3-建造者模式" class="headerlink" title="3. 建造者模式"></a>3. 建造者模式</h4><p>建造者模式（Builder）：通俗的说，就是使用多个简单的对象一步一步构建成一个复杂的对象，建造者模式又叫做生成器模式。</p>
<p>看名称我们首先想到的就是造房子。建造者模式就像是施工队，在了解了客户的建房需求后，将需求分解成多个子任务，分配给团队的各小组。各小组分工合作最终得到需求的房子。</p>
<ul>
<li>场景1</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Builder = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//成员01 -- 决定厅室</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Rooms</span>(<span class="params">member</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( member &lt;= <span class="number">0</span> )&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"入住人数错误！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.rooms = member&gt;=<span class="number">3</span>?<span class="number">3</span>:<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成员02 -- 决定面积</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">FloorSpace</span>(<span class="params">budget</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="keyword">typeof</span> budget !== <span class="string">"number"</span>) || <span class="built_in">Number</span>.isNaN(budget) || (budget &lt; <span class="number">60</span>) )&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"预算过低或错误！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.budget = budget/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成员03 -- 整体风格</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Style</span>(<span class="params">style</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.style = style || <span class="string">"常规风格"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">        <span class="comment">//住几人，预算多少(万)，风格</span></span><br><span class="line">        <span class="keyword">constructor</span>(member, budget, style) &#123;</span><br><span class="line">            Rooms.call(<span class="keyword">this</span>,member);</span><br><span class="line">            FloorSpace.call(<span class="keyword">this</span>,budget);</span><br><span class="line">            Style.call(<span class="keyword">this</span>,style);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//包工头获取客户需求，然后建造房子</span></span><br><span class="line"><span class="keyword">let</span> house1 = <span class="keyword">new</span> Builder(<span class="number">1</span>,<span class="number">100</span>,<span class="string">"小清新"</span>);<span class="comment">//客户1的需求</span></span><br><span class="line"><span class="keyword">let</span> house2 = <span class="keyword">new</span> Builder(<span class="number">4</span>,<span class="number">200</span>,<span class="string">"欧美"</span>);<span class="comment">//客户2的需求</span></span><br></pre></td></tr></table></figure>
<p>建造者模式中有两个重要组成，一个是建造者，如上成员01，成员02以及成员03，另一个则是把这些建造者组合起来，如上Builder。</p>
<p><strong>总结：</strong>当我们构造的对象，内部结构较复杂时，使用建造者模式将内部各模块分开创建就非常合适。</p>
<h4 id="4-原型模式"><a href="#4-原型模式" class="headerlink" title="4. 原型模式"></a>4. 原型模式</h4><p>原型模式（Prototype）：用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。可以看作是基于原型继承的模式，创建对象作为其他对象的原型。</p>
<ul>
<li>场景</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x)&#123;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">    &#125;</span><br><span class="line">    showX()&#123;</span><br><span class="line">        alert( <span class="keyword">this</span>.x );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子类A</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildA</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x,y)&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line">    showY()&#123;</span><br><span class="line">        alert( <span class="keyword">this</span>.y );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//子类B</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildB</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x,z)&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.z = z;</span><br><span class="line">    &#125;</span><br><span class="line">    showZ()&#123;</span><br><span class="line">        alert( <span class="keyword">this</span>.z );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>多个类具有相同的属性或方法，那我们就可以通过原型继承来创造出类或者实例对象。</p>
<h2 id="结构性设计模式"><a href="#结构性设计模式" class="headerlink" title="结构性设计模式"></a>结构性设计模式</h2><p>结构性设计模式 – 通常与对象组合有关，关注于将多个类或对象组合成一个大的系统，方便使用。该模式有助于确保在系统某一部分变化时，仅需改变系统中对应的部分，而不需要改变整个结构。该类模式中常见的包括外观模式、适配器模式以及装饰器模式等。</p>
<h4 id="1-外观模式"><a href="#1-外观模式" class="headerlink" title="1. 外观模式"></a>1. 外观模式</h4><p>外观模式（Facede）：将一组子接口统一为一个接口，这样调用起来更加方便，比较常见的应用场景就是对浏览器各种API的兼容处理。</p>
<ul>
<li>场景</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以添加事件为例：使用事件添加方式 addEventListener，但是IE不兼容，需要使用attachEvent，从而添加一个click的事件写法如下：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//code……</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="built_in">document</span>.addEventListener )&#123;</span><br><span class="line">    oDiv.addEventListener(<span class="string">"click"</span> , click, <span class="literal">false</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">document</span>.attachEvent)&#123;</span><br><span class="line">    oDiv.attachEvent(<span class="string">"onclick"</span> , click);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    oDiv.onclick = click;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//封装一下：</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addEvent</span>(<span class="params">dom , eName , fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( <span class="built_in">document</span>.addEventListener )&#123;</span><br><span class="line">        dom.addaddEventListener(eName,fn,<span class="literal">false</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>( <span class="built_in">document</span>.attachEvent )&#123;</span><br><span class="line">        dom.attachEvent(<span class="string">"on"</span>+eName,fn);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        dom[<span class="string">"on"</span>+eName] = fn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">addEvent(oDiv , <span class="string">"click"</span> ,click);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//code……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把这些相应的兼容操作综合起来，通过外观模式就能封装成一个小型的js库。</p>
<p><strong>总结：</strong>对外提供统一的接口，内部封装各种子操作。这就是外观模式。</p>
<h4 id="2-适配器模式"><a href="#2-适配器模式" class="headerlink" title="2. 适配器模式"></a>2. 适配器模式</h4><p>适配器模式（Adapter）：将一个类的接口转换成另外一个接口，以满足用户需求，解决接口不一样而产生的兼容问题。</p>
<p>适配的概念通俗的说，可以类比读卡器、耳机转换器的作用。</p>
<ul>
<li>场景1</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//某个项目中我们接口拿到的数据data是数组格式。</span></span><br><span class="line"><span class="comment">//一段时间后，后端更新了数据结构，返回的数据变成了键值对形式，如果此时前端修改之前的代码比较复杂，就可以使用适配器模式，在拿到相应数据后，将格式转换为数组：</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    success : <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">        msg = [msg.name,msg.age,msg.marry];</span><br><span class="line">        <span class="comment">//调用done</span></span><br><span class="line">        done(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">done</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, length = msg.length; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="comment">//dosomething……</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>场景2</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 另外一种比较常见的场景是，对方法参数的处理。比如参数很多时，当使用以下方式传参，既要注意顺序，还要注意参数赋值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">name,age,sex,index</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//dosomething……</span></span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="string">"张三"</span>,<span class="number">18</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用适配器模式，我们将参数合并成一个对象，在方法内部对参数对象结构获取相应的值。就可以避免以上问题</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;name,age,sex,index=<span class="number">1</span>&#125;=options;</span><br><span class="line">    <span class="comment">//dosomething……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>由于各种原因，导致现有接口和之前的不一样，而修改比较麻烦时，就可以考虑使用适配器对接口进行适配。</p>
<h4 id="3-装饰者模式"><a href="#3-装饰者模式" class="headerlink" title="3. 装饰者模式"></a>3. 装饰者模式</h4><p>装饰者模式（Decorator）：在不改变原对象的基础上，对其进行包装扩展，旨在促进代码复用。看起来类似于原型模式，但是由于装饰本身对于类原有的基本功能不是必要的，不需要合并到超类，所以不选择原型模式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name,sex)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.writer = sex;</span><br><span class="line">    &#125;</span><br><span class="line">    showName()&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> Abook = <span class="keyword">new</span> Teacher(<span class="string">"Abook"</span>,<span class="string">"Tom"</span>);</span><br><span class="line"><span class="comment">//code…… </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要对实例Abook进行扩展</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Decorator</span>(<span class="params">obj,type</span>)</span>&#123;</span><br><span class="line">    obj.type = type;</span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line">Decorator(Abook,<span class="string">"小说"</span>);</span><br><span class="line"><span class="comment">//code……</span></span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>装饰者模式可以动态的修改对象，而不用创建新的实例。</p>
<h4 id="4-桥接模式"><a href="#4-桥接模式" class="headerlink" title="4. 桥接模式"></a>4. 桥接模式</h4><p>桥接模式（Bridge）：将抽象部分与它的实现部分解耦，使得二者可以独立变化。</p>
<ul>
<li>场景</li>
</ul>
<p>用桥接模式联结多个类：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基本类，实现部分</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="comment">//code……</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="comment">//code……</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="comment">//code……</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//桥接类，抽象部分</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bridge1</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.a = <span class="keyword">new</span> A();</span><br><span class="line">        <span class="keyword">this</span>.b = <span class="keyword">new</span> B();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//code……</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bridge2</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.b = <span class="keyword">new</span> B();</span><br><span class="line">        <span class="keyword">this</span>.c = <span class="keyword">new</span> C();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//code……</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>什么时候用到桥接？当一个系统中的多个实现部分都有相应的变化逻辑时，如果写在一起会导致结构复杂，可读性以及可维护性低。此时可以适应桥接模式，把抽象部分和实现部分分别抽离出来，然后组合使用。</p>
<h4 id="5-组合模式"><a href="#5-组合模式" class="headerlink" title="5. 组合模式"></a>5. 组合模式</h4><p>组合模式（Composite）：又称部分-整体模式，组合模式依据树形结构来组合对象，用来表示部分以及整体层次，使得用户对单个对象和组合对象的使用具有一致性。</p>
<p>常见的例子就是清理文件时，不管是删除单个文件还是文件夹都是一样的操作。</p>
<ul>
<li>场景</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DOM树是典型的树形结构，</span></span><br><span class="line"><span class="comment">// 一个典型的应用场景就是JQ对DOM元素的处理。</span></span><br><span class="line">$(<span class="string">"#box"</span>).css(<span class="string">"color"</span> , <span class="string">'red'</span>); <span class="comment">// 单个id为box的元素</span></span><br><span class="line">$(<span class="string">".box"</span>).css(<span class="string">"color"</span> , <span class="string">"red"</span>); <span class="comment">// 一组类名为box的元素</span></span><br></pre></td></tr></table></figure>
<p>**总结：使用组合模式将部分组合成一个整体，忽略单个对象和多个对象的使用区别，统一调用接口。</p>
<h4 id="6-享元模式"><a href="#6-享元模式" class="headerlink" title="6. 享元模式"></a>6. 享元模式</h4><p>享元模式（Flyweight ）：通过共享大量细粒度的对象，避免拥有相同内容造成额外的开销。</p>
<ul>
<li>场景</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//最常见的享元模式，具有相同的事件函数</span></span><br><span class="line">a.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="keyword">this</span>.name)&#125;;</span><br><span class="line">b.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="keyword">this</span>.name)&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用享元模式</span></span><br><span class="line"><span class="keyword">let</span> clickEvent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="keyword">this</span>.name)&#125;;</span><br><span class="line">a.onclick = b.onclick = clickEvent;</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>享元模式就是相同的部分提出来或者采用其他形式优化掉，一般需要配合单例模式来实现。</p>
<h4 id="7-代理模式"><a href="#7-代理模式" class="headerlink" title="7. 代理模式"></a>7. 代理模式</h4><p>代理模式（Proxy）：为对象提供一个代理，用来控制对这个对象的访问。</p>
<p>代理模式就是通过代理访问对象而不是直接访问对象。具体应用可以参看ES6的Proxy。</p>
<h2 id="行为设计模式"><a href="#行为设计模式" class="headerlink" title="行为设计模式"></a>行为设计模式</h2><p>行为设计模式 – 专注于不同对象之间的通信。主要包括观察者模式、访问者模式以及迭代器模式等。</p>
<h4 id="1-观察者模式"><a href="#1-观察者模式" class="headerlink" title="1. 观察者模式"></a>1. 观察者模式</h4><p>观察者模式（Observer）：又叫发布-订阅模式，定义了一种一对多的关系，让多个观察者对象同时监听某一个对象，当该对象发生改变时，多个观察者对象也做出相应的改变。<br>典型的例子就是vue响应式的实现。</p>
<p>组成该模式的有两个关键部分：多个订阅者 和 消息发布者。</p>
<ul>
<li>场景</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//事件绑定的机制，其实就是一种观察者模式</span></span><br><span class="line"><span class="comment">//事件触发的时候（发布消息）就执行对应的 事件函数（订阅者）</span></span><br><span class="line"><span class="comment">//代码省略</span></span><br></pre></td></tr></table></figure>
<h4 id="2-访问者模式"><a href="#2-访问者模式" class="headerlink" title="2. 访问者模式"></a>2. 访问者模式</h4><p>访问者模式（Visitor）：在不改变对象的前提下，定义作用于对象的新操作,js中常通过call/apply来实现。</p>
<ul>
<li>场景1</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> aMan = &#123;</span><br><span class="line">    addInfo()&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = <span class="number">18</span>;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">"Tom"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">aMan.addInfo();</span><br><span class="line"></span><br><span class="line"><span class="comment">//给对象obj添加这两个属性</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line">aMan.addAttr.call(obj);</span><br></pre></td></tr></table></figure>
<h4 id="3-迭代器模式"><a href="#3-迭代器模式" class="headerlink" title="3. 迭代器模式"></a>3. 迭代器模式</h4><p>迭代器模式（Iterator）：在不暴露对象内部结构的同时，按顺序地访问集合对象内部的各个属性。</p>
<p>常见的例子比如forEach，every，map等等。在ES6里面很多功能都是基于迭代器来实现的。迭代器包括内部迭代器和外部迭代器两种。</p>
<ul>
<li>内部迭代器</li>
</ul>
<p>迭代的过程在方法内部完成，在外部无法干涉迭代的进度，比如forEach：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">arr.forEach(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>外部迭代器</li>
</ul>
<p>必须通过外部的操作来执行下一步迭代，如ES6中.next()操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> arrIterator = arr[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( arrIterator.next() ); <span class="comment">//&#123;value:1,done:false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log( arrIterator.next() ); <span class="comment">//&#123;value:2,done:false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log( arrIterator.next() ); <span class="comment">//&#123;value:3,done:false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log( arrIterator.next() ); <span class="comment">//&#123;value:undefined,done:true&#125;</span></span><br></pre></td></tr></table></figure>
<p>js实现一个外部迭代器迭代数组：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Iterator = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = <span class="number">0</span>,</span><br><span class="line">        length = arr.length;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        next : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                value : arr[index++],</span><br><span class="line">                done : index &gt;= length</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ES6定义了Object.keys等相关的方法，让我们能遍历对象的属性。ES6定义的Generator函数和async函数，让我们可以手动的控制函数执行的流程。</p>
<h4 id="4-状态模式"><a href="#4-状态模式" class="headerlink" title="4. 状态模式"></a>4. 状态模式</h4><p>状态模式（State Pattern）：当对象内部状态发生改变时，它的行为也对应的发生改变，使之看起来像是改变了这个对象。</p>
<p>当需求有多种状态，并在某些条件下会从一种状态变成另一种状态时，使用状态模式就很合适。</p>
<ul>
<li>场景 – 开关灯状态的切换</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不使用状态模式的常见写法</span></span><br><span class="line"><span class="keyword">const</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>);</span><br><span class="line"><span class="keyword">let</span> state = <span class="string">"off"</span>;</span><br><span class="line"><span class="keyword">let</span> switchFn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( state === <span class="string">"off"</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"from off to on"</span>);</span><br><span class="line">        state = <span class="string">"on"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>( state === <span class="string">"on"</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"from on to off"</span>);</span><br><span class="line">        state = <span class="string">"off"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">btn.onclick = switchFn;</span><br></pre></td></tr></table></figure>
<p>当某状态对应的逻辑需要修改，或者需要添加新的模式时，我们需要修改整个switchFn方法。此时显而易见，各状态之间耦合性高，所以我们可以对代码进行优化如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用状态模式</span></span><br><span class="line"><span class="keyword">let</span> Switch = &#123;</span><br><span class="line">    <span class="comment">//状态机</span></span><br><span class="line">    FSM : &#123;</span><br><span class="line">        on : &#123;</span><br><span class="line">            to : <span class="string">"off"</span>,</span><br><span class="line">            action : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"from on to off"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        off : &#123;</span><br><span class="line">            to : <span class="string">"on"</span>,</span><br><span class="line">            action : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"from off to on"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当前状态</span></span><br><span class="line">    currentState : <span class="string">"off"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化事件</span></span><br><span class="line">    init()&#123;</span><br><span class="line">        <span class="keyword">const</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">        btn.onclick = <span class="keyword">this</span>.transition.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//状态切换</span></span><br><span class="line">    transition()&#123;</span><br><span class="line">        <span class="keyword">const</span> s = <span class="keyword">this</span>.FSM[<span class="keyword">this</span>.currentState];</span><br><span class="line">        <span class="keyword">this</span>.currentState = s.to;</span><br><span class="line">        s.action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>总结：</strong>适用状态模式的常见场景：</p>
<pre><code>1. 对象的行为基于它的状态，对应的操作会改变它的状态；
2. 
</code></pre><ol start="2">
<li>存在大量的判断语句时，可以考虑使用状态模式进行消除。</li>
</ol>
<h4 id="5-策略模式"><a href="#5-策略模式" class="headerlink" title="5. 策略模式"></a>5. 策略模式</h4><p>策略模式（Strategy）：策略模式定义了一系列的算法，并将每一个算法封装起来，而且使他们可以相互替换，且具有一定的独立性。简单的说，就是一个类的行为或其算法可以在运行时更改。</p>
<p><em>一系列的算法，可以相互替换</em>，也就是说为了同一个目的，可能采取的算法不同。</p>
<ul>
<li>场景</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//玩家类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalCost = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.level = <span class="string">"C"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    consum(price)&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalCost += price;</span><br><span class="line">        <span class="keyword">let</span> result = Strategy.calc(<span class="keyword">this</span>.level , price);</span><br><span class="line">        <span class="keyword">this</span>.getLevel();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    getLevel()&#123;</span><br><span class="line">        <span class="keyword">let</span> totalCost = <span class="keyword">this</span>.totalCost;</span><br><span class="line">        <span class="keyword">if</span>( totalCost &gt;= <span class="number">50000</span> )&#123;</span><br><span class="line">            <span class="keyword">this</span>.level = <span class="string">"S"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>( totalCost &gt;= <span class="number">30000</span> )&#123;</span><br><span class="line">            <span class="keyword">this</span>.level = <span class="string">"A"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>( totalCost &gt;= <span class="number">20000</span> )&#123;</span><br><span class="line">            <span class="keyword">this</span>.level = <span class="string">"B"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.level = <span class="string">"C"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//计价策略类</span></span><br><span class="line"><span class="keyword">let</span> Strategy = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//策略</span></span><br><span class="line">    <span class="keyword">let</span> s = &#123;</span><br><span class="line">        S(price)&#123;</span><br><span class="line">            <span class="keyword">return</span> price*<span class="number">0.85</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        A(price)&#123;</span><br><span class="line">            <span class="keyword">return</span> price*<span class="number">0.9</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        B(price)&#123;</span><br><span class="line">            <span class="keyword">return</span> price*<span class="number">0.95</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        C(price)&#123;</span><br><span class="line">            <span class="keyword">return</span> price;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">//添加新策略的接口</span></span><br><span class="line">        addsty(name , fn)&#123;</span><br><span class="line">            s[name] = fn;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//计算策略对应最终价格的接口</span></span><br><span class="line">        calc(sty,price)&#123;</span><br><span class="line">            <span class="keyword">if</span>( s[sty] )&#123;</span><br><span class="line">                <span class="keyword">return</span> s[sty](price);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"对应的优惠策略不存在！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试：</span></span><br><span class="line"><span class="keyword">let</span> afei = <span class="keyword">new</span> Player();</span><br><span class="line"><span class="built_in">console</span>.log(afei.consum(<span class="number">20</span>));</span><br><span class="line"><span class="built_in">console</span>.log(afei.consum(<span class="number">10000</span>));</span><br><span class="line"><span class="built_in">console</span>.log(afei.consum(<span class="number">50000</span>));</span><br><span class="line"><span class="built_in">console</span>.log(afei.consum(<span class="number">200</span>));</span><br></pre></td></tr></table></figure>
<h4 id="6-命令模式"><a href="#6-命令模式" class="headerlink" title="6. 命令模式"></a>6. 命令模式</h4><p>命令模式（Command）：基于传入的参数进行驱动，将请求与实现解耦并封装成独立对象，从而使不同的请求对客户端的实现参数化。</p>
<ul>
<li>场景</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> CanvasCmd = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>),</span><br><span class="line">        ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">    <span class="keyword">let</span> cmdList = &#123;</span><br><span class="line">        beginPath()&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">            ctx.beginPath();</span><br><span class="line">        &#125;,</span><br><span class="line">        close()&#123;</span><br><span class="line">            ctx.closePath();</span><br><span class="line">        &#125;,</span><br><span class="line">        strokeStyle(color)&#123;</span><br><span class="line">            ctx.strokeStyle = color;</span><br><span class="line">        &#125;,</span><br><span class="line">        moveTo(x,y)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(x,y);</span><br><span class="line">            ctx.moveTo(x,y);</span><br><span class="line">        &#125;,</span><br><span class="line">        lineTo(x,y)&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(x,y);</span><br><span class="line">            ctx.lineTo(x,y);</span><br><span class="line">        &#125;,</span><br><span class="line">        stroke()&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">            ctx.stroke();</span><br><span class="line">        &#125;,</span><br><span class="line">        fillStyle(color)&#123;</span><br><span class="line">            ctx.fillStyle = color;</span><br><span class="line">        &#125;,</span><br><span class="line">        fillRect(x,y,width,height)&#123;</span><br><span class="line">            ctx.fillRect(x,y,width,height);</span><br><span class="line">        &#125;,</span><br><span class="line">        strokeRect(x,y,width,height)&#123;</span><br><span class="line">            ctx.strokeRect(x,y,width,height);</span><br><span class="line">        &#125;,</span><br><span class="line">        arc(x,y,r,begin,end,dir)&#123;</span><br><span class="line">            ctx.arc(x,y,r,begin,end,dir);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">       <span class="comment">// 执行命令</span></span><br><span class="line">        execute(data)&#123;</span><br><span class="line">            data.forEach(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> &#123;command,param&#125; = item;</span><br><span class="line">                cmdList[command] &amp;&amp; cmdList[command](...param);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">       <span class="comment">// 添加新的命令</span></span><br><span class="line">        addCmd(key,value)&#123;</span><br><span class="line">            cmdList[key] = value;</span><br><span class="line">        &#125;,</span><br><span class="line">      	<span class="comment">// 移除命令</span></span><br><span class="line">        removeCmd(key)&#123;</span><br><span class="line">            <span class="keyword">delete</span> cmdList[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">CanvasCmd.execute([</span><br><span class="line">    &#123;<span class="attr">command</span>:<span class="string">"beginPath"</span>,<span class="attr">param</span>:[]&#125;,</span><br><span class="line">    &#123;<span class="attr">command</span>:<span class="string">"strokeStyle"</span>,<span class="attr">param</span>:[<span class="string">"red"</span>]&#125;,</span><br><span class="line">    <span class="comment">// other commands</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<h4 id="7-责任链模式"><a href="#7-责任链模式" class="headerlink" title="7. 责任链模式"></a>7. 责任链模式</h4><p>责任链模式（Chain of responsibility）：为请求创建了一个接收者对象的链，对请求的发送者和接收者进行解耦。每个接收者都包含对另一个接收者的引用，当前接收者无法处理该请求，就会把请求交给下一个接收者。类似于原型链。</p>
<ul>
<li>场景</li>
</ul>
<p>情景：请假流程，小于3天，组长处理；大于3天小于5天，部门领导处理；大于5天总经理处理。</p>
<p>我们先按找平常的写法实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( value &lt;= <span class="number">3</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交组长处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( value &lt;= <span class="number">5</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交部门领导处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( value &gt; <span class="number">5</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交总经理处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<p>判断语句太多，改用责任链模式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将每个分支结构分离：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">director01</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( value &lt;= <span class="number">3</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交组长处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//移交给下一个处理人</span></span><br><span class="line">        director02(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">director02</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( value &lt;= <span class="number">5</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交部门领导处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//移交给下一个处理人</span></span><br><span class="line">        director03(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">director03</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( value &gt; <span class="number">5</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交总经理处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//只需要从第一个处理人开始</span></span><br><span class="line">director01(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<p>此时，耦合程度比上面的写法要好。但是每个处理人内部都必须强关联下一个处理人，不然就没法链式调用，耦合性还是很高，如果要添加一个处理人，那要改的地方就有该处理人上下两级，比较麻烦。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//职责链类：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chain</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.successor = [];</span><br><span class="line">        <span class="keyword">this</span>.length = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    setSuccessor(...rest)&#123;</span><br><span class="line">        <span class="keyword">this</span>.successor = rest;</span><br><span class="line">        <span class="keyword">this</span>.length = rest.length;</span><br><span class="line">    &#125;</span><br><span class="line">    request(...rest)&#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> <span class="title">getResult</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>( index &gt;= <span class="keyword">this</span>.length )&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"无法处理。"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> result = <span class="keyword">this</span>.successor[index](...rest);</span><br><span class="line">            <span class="keyword">if</span>( result === <span class="string">"next"</span> )&#123;</span><br><span class="line">                index ++;</span><br><span class="line">                getResult.call(<span class="keyword">this</span>,index);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).call(<span class="keyword">this</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将每个分支结构分离：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">director01</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( value &lt;= <span class="number">3</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交组长处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//无须再强关联下一个处理函数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"next"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">director02</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( value &lt;= <span class="number">5</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交部门领导处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"next"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">director03</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( value &gt; <span class="number">5</span> )&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"移交总经理处理。"</span>);</span><br><span class="line">        <span class="comment">//some code……</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现链</span></span><br><span class="line"><span class="keyword">let</span> request = <span class="keyword">new</span> Chain();</span><br><span class="line"><span class="comment">//设置处理队列</span></span><br><span class="line">request.setSuccessor(</span><br><span class="line">    director01,</span><br><span class="line">    director02,</span><br><span class="line">    director03,</span><br><span class="line">);</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">request.request(<span class="number">5</span>);</span><br><span class="line">request.request(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h4 id="8-中介者模式"><a href="#8-中介者模式" class="headerlink" title="8. 中介者模式"></a>8. 中介者模式</h4><p>中介者模式（Mediator）：提供了一个中介类，该类通常处理不同类之间的通信，使对象之间不再相互引用，降低他们之间的耦合，提高代码的可维护性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mediator = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> topics = &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> subscribe = <span class="function"><span class="keyword">function</span> (<span class="params">topic,fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!topics[topic]) topics[topic] = []</span><br><span class="line">    topics[topic].push(&#123;</span><br><span class="line">      ctx: <span class="keyword">this</span>,</span><br><span class="line">      cb:fn,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> publish = <span class="function"><span class="keyword">function</span> (<span class="params">topic</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> args</span><br><span class="line">    <span class="keyword">if</span>(!topics[topic])<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line">    topics[topic].forEach(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">let</span> subscription = item</span><br><span class="line">      subscription.cb.apply(item.ctx, args)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    Publish: publish,</span><br><span class="line">    Subscribe: subscribe,</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      obj.publish = publish</span><br><span class="line">      obj.subscribe = subscribe</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<h4 id="9-解释器模式"><a href="#9-解释器模式" class="headerlink" title="9. 解释器模式"></a>9. 解释器模式</h4><p>解释器模式（Interpreter）：定义一种文法的表示，并定义一种解释器，通过这个解释器来解析对应文法的内容。</p>
<ul>
<li>场景  –  jQ提供的选择器</li>
</ul>
<p>原生js获取DOM元素的方式是有限的，jQ给我们提供了更为复杂的选择方式，比如：<code>$(&quot;#box p&quot;)</code>，这个参数规则就是jQ定义的一套选择元素的<em>文法</em>，而解析这个字符串，使之获取对应DOM元素的代码就是<em>解释器</em>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/组件间的通信—派发（dispatch)和广播（broadcast)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/组件间的通信—派发（dispatch)和广播（broadcast)/" itemprop="url">组件间的通信—派发（dispatch)和广播（broadcast)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>根据前文，provide/inject的使用具有局限性，对于父子组件的通信必须有其他的办法。</p>
<h3 id="on-和-emit"><a href="#on-和-emit" class="headerlink" title="$on 和 $emit"></a>$on 和 $emit</h3><p>在当前vue.js中，较常用的是$on 和 $emit。$emit主要用来触发事件，而$on用来监听被触发的事件。一般来说，子组件中使用$emit，父组件中使用$on。二者具体的用法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;button @click=&quot;handleClick&quot;&gt;</span><br><span class="line">   &lt;slot&gt;确定&lt;/slot&gt;</span><br><span class="line"> &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export defalut&#123;</span><br><span class="line">        methods:&#123;</span><br><span class="line">            handleClick()&#123;</span><br><span class="line">                this.$emit(&apos;parent&apos;,&apos;123&apos;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;i-btn @parent = &apos;test&apos;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default&#123;</span><br><span class="line">        methods:&#123;</span><br><span class="line">            test(data)&#123;</span><br><span class="line">                console.log(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="dispatch-和-broadcast"><a href="#dispatch-和-broadcast" class="headerlink" title="dispatch 和 broadcast"></a>dispatch 和 broadcast</h3><p>上述写法一般只能用于一级的父子组件，那么对于多级，在1.x版本的vue.js中使用dispatch 和 broadcast。</p>
<ul>
<li><p>dispatch: 子组件向所有的父组件分发，从最近的向远处传播</p>
</li>
<li><p>broadcast: 父组件向子组件广播，从近到远</p>
</li>
</ul>
<p>他们传递的事件一旦被某组件通过$on监听到了，就会停止冒泡下去。可惜的是，在新版本vue.js中已经被废弃。</p>
<h3 id="自主实现dispatch-和-broadcast"><a href="#自主实现dispatch-和-broadcast" class="headerlink" title="自主实现dispatch 和 broadcast"></a>自主实现dispatch 和 broadcast</h3><p>预计功能：可以向父级组件或子组件，由近到远传播查询，直到找到对应的组件（更据唯一组件name是否一致），然后在改组件中进行监听。</p>
<p>需要传的参数：目标组件名，事件名，事件中用到的参数</p>
<p>具体代码实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// emmiter.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父组件向子组件广播事件</span></span><br><span class="line"><span class="comment"> * @param cName 目标组件名</span></span><br><span class="line"><span class="comment"> * @param eName 事件名</span></span><br><span class="line"><span class="comment"> * @param eData 事件参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">broadCast</span>(<span class="params">cName,eName,eData</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> children = <span class="keyword">this</span>.$children</span><br><span class="line">  children.forEach(<span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> name = ele.$options.name</span><br><span class="line">    <span class="keyword">if</span>(name === cName)&#123;</span><br><span class="line">      ele.$emit.apply(ele,[eName].concat([eData]))</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">      broadCast.apply(ele,[cName,eName].concat([eData]))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子组件向父组件分发事件</span></span><br><span class="line"><span class="comment"> * @param cName 目标组件名</span></span><br><span class="line"><span class="comment"> * @param eName 事件名</span></span><br><span class="line"><span class="comment"> * @param eData 事件参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">cName,eName,eData</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> parent = <span class="keyword">this</span>.$parent || <span class="keyword">this</span>.$root</span><br><span class="line">  <span class="keyword">let</span> name = parent.$options.name</span><br><span class="line">  <span class="keyword">while</span>(parent &amp;&amp; (!name || name!== cName))&#123;</span><br><span class="line">    parent = parent.$parent</span><br><span class="line">    <span class="keyword">if</span>(parent)&#123;</span><br><span class="line">      name = parent.$options.name</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(parent)&#123;</span><br><span class="line">    parent.$emit.apply(ele,[eName].concat([eData]))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">  methods:&#123;</span><br><span class="line">    broadCast(cName,eName,eData)&#123;</span><br><span class="line">      broadCast.call(<span class="keyword">this</span>,cName,eName,eData)</span><br><span class="line">    &#125;,</span><br><span class="line">    dispatch(cName,eName,eData)&#123;</span><br><span class="line">      dispatch.call(<span class="keyword">this</span>,cName,eName,eData)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// c-a.vue  </span><br><span class="line">&lt;tempalte&gt;</span><br><span class="line">  &lt;button @click=&apos;handleClick&apos;&gt;确认&lt;/button&gt;</span><br><span class="line">&lt;/tempalte&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"> import Emmiter from &apos;../mixins/emmiter.js&apos;</span><br><span class="line"> export default&#123;</span><br><span class="line">   mixins: [Emmiter]</span><br><span class="line">   name: &apos;c-a&apos;,</span><br><span class="line">   methods:&#123;</span><br><span class="line">     handleClick()&#123;</span><br><span class="line">       this.broadCast(&apos;c-b&apos;,&apos;test&apos;,&apos;当前组件的数据传给子组件&apos;)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// c-b.vue  </span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;i-btn @test=&quot;out&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"> import &apos;iBtn&apos; from &apos;../c-a&apos;</span><br><span class="line"> export default&#123;</span><br><span class="line">   components:&#123;iBtn&#125;,</span><br><span class="line">   name:&apos;c-b&apos;,</span><br><span class="line">  //  created()&#123;</span><br><span class="line">  //    this.$on(&apos;test&apos;,this.out)</span><br><span class="line">  //  &#125;,</span><br><span class="line">   methods:&#123;</span><br><span class="line">     out(data)&#123;</span><br><span class="line">       console.log(data)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/组件间的通信/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/组件间的通信/" itemprop="url">组件间的通信-开始</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>了解一个组件，最基础的三个部分： prop, slot 以及 event。</p>
<ul>
<li><p>prop</p>
<p>prop定义了该组件有哪些属性是可配置的，对于prop最好使用对象的写法，这样就可以对传入的prop进行校验。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">props:&#123;</span><br><span class="line">    size:&#123;</span><br><span class="line">        validator(value)&#123;<span class="keyword">return</span> test(value)&#125;,</span><br><span class="line">        <span class="keyword">default</span>: <span class="string">"default"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    page: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        defalut: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>slot</p>
<p>插槽，主要用来对组件进行扩展，可以是文字，也可以是html或者其他组件。</p>
<template><br>  <button :class="'i-button-size' + size" :disabled="disabled"><br>    <slot></slot><br>  </button><br></template>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i-button</span>&gt;</span>按钮 1<span class="tag">&lt;/<span class="name">i-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">strong</span>&gt;</span>按钮 2<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">i-button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上是单独一个插槽，也可以使用多个插槽。插槽也可以是命名的插槽。</p>
<slot name="icon"></slot><br><slot>默认显示内容</slot>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">i-icon</span> <span class="attr">slot</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"checkmark"</span>&gt;</span><span class="tag">&lt;/<span class="name">i-icon</span>&gt;</span></span><br><span class="line">  按钮 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">i-button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>event</p>
<p>对于自定义的事件，会使用到$emit, 具体的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"> &lt;button @click=&quot;test&quot;&gt;BUTTON&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default&#123;</span><br><span class="line">        methods:&#123;</span><br><span class="line">            test(event)&#123;</span><br><span class="line">                this.$emit(&apos;f-click&apos;,event)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i-btn</span> @<span class="attr">f-click</span>=<span class="string">"tan"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>tips: 对于一些可能和原生事件混淆的自定义事件（如click），可以通过@click.native来区别</p>
</li>
</ul>
<p>接着讲进入本系列的主题——组件间的通信。</p>
<p>组件间的关系可以分为父子关系，兄弟关系。针对父子关系，又可以包含多代父子。组件通信方式多凭借$parent,$children,ref等。</p>
<p>父子组件通信可以通过$parent,$children,但是这只能针对于一代的父子；如果相隔多代，就不可行了。</p>
<p>使用ref的简单例子如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;component-a ref=&quot;comA&quot;&gt;&lt;/component-a&gt;</span><br><span class="line">...</span><br><span class="line">this.$refs.comA</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>所以在实际组件的开发中，我们会考虑使用别的方法。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/变量的解构赋值/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/变量的解构赋值/" itemprop="url">变量的解构赋值</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="数组解构赋值"><a href="#数组解构赋值" class="headerlink" title="数组解构赋值"></a>数组解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> [x, , y] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> [head, ...tail] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> [x, y, ...z] = [<span class="string">'a'</span>]; <span class="comment">// x=a,y=undefined,z=[]</span></span><br><span class="line"><span class="keyword">let</span> [x, y = <span class="string">'b'</span>] = [<span class="string">'a'</span>, <span class="literal">undefined</span>]; <span class="comment">// x='a', y='b'</span></span><br><span class="line"><span class="keyword">let</span> [x, y, z] = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]); <span class="comment">// x='a'</span></span><br></pre></td></tr></table></figure>
<h3 id="对象解构赋值"><a href="#对象解构赋值" class="headerlink" title="对象解构赋值"></a>对象解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; foo, bar &#125; = &#123; <span class="attr">foo</span>: <span class="string">'aaa'</span>, <span class="attr">bar</span>: <span class="string">'bbb'</span> &#125;;  <span class="comment">// foo-&gt;aaa,bar-&gt;bbb</span></span><br><span class="line"><span class="keyword">let</span> &#123; baz &#125; = &#123; <span class="attr">foo</span>: <span class="string">'aaa'</span>, <span class="attr">bar</span>: <span class="string">'bbb'</span> &#125;; <span class="comment">// baz-&gt;undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; log &#125; = <span class="built_in">console</span>;</span><br><span class="line">log(<span class="string">'hello'</span>) <span class="comment">// hello</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123; <span class="attr">foo</span>: baz &#125; = &#123; <span class="attr">foo</span>: <span class="string">'aaa'</span>, <span class="attr">bar</span>: <span class="string">'bbb'</span> &#125;; <span class="comment">// baz-&gt;foo-&gt;aaa,foo-&gt;undefined</span></span><br></pre></td></tr></table></figure>
<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误的写法</span></span><br><span class="line"><span class="keyword">let</span> x;</span><br><span class="line">&#123;x&#125; = &#123;<span class="attr">x</span>: <span class="number">1</span>&#125;;</span><br><span class="line"><span class="comment">// SyntaxError: syntax error</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正确的写法</span></span><br><span class="line"><span class="keyword">let</span> x;</span><br><span class="line">(&#123;x&#125; = &#123;<span class="attr">x</span>: <span class="number">1</span>&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="字符串解构赋值"><a href="#字符串解构赋值" class="headerlink" title="字符串解构赋值"></a>字符串解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [a, b, c, d, e] = <span class="string">'hello'</span>; <span class="comment">// a-&gt;'h',...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;<span class="attr">length</span> : len&#125; = <span class="string">'hello'</span>; <span class="comment">//len:5</span></span><br></pre></td></tr></table></figure>
<h3 id="数字和布尔值的解构赋值"><a href="#数字和布尔值的解构赋值" class="headerlink" title="数字和布尔值的解构赋值"></a>数字和布尔值的解构赋值</h3><p>解构赋值时，如果等号右边是数值和布尔值，则会先转为对象</p>
<h3 id="函数参数解构赋值"><a href="#函数参数解构赋值" class="headerlink" title="函数参数解构赋值"></a>函数参数解构赋值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">[x, y]</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line">add([<span class="number">1</span>, <span class="number">2</span>]); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]].map(<span class="function">(<span class="params">[a, b]</span>) =&gt;</span> a + b);</span><br><span class="line"><span class="comment">// [ 3, 7 ]</span></span><br></pre></td></tr></table></figure>
<h3 id="圆括号-问题"><a href="#圆括号-问题" class="headerlink" title="圆括号()问题"></a>圆括号()问题</h3><p>ES6 的规则是，只要有可能导致解构的歧义，就不得使用圆括号。建议只要有可能，就不要在模式中放置圆括号。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/组件间的通信-projectinject/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/组件间的通信-projectinject/" itemprop="url">组件间的通信-provide/inject</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在实际开发中，对于比较复杂的组件间的通信，我们一般会引入vux等第三方库。但是在单独开发组件，不考虑引入第三方资源，如开发组件库时，我们可以使用vue内置的provide和inject。</p>
<p>provide相当于主动提供，而inject是依赖注入。</p>
<p>如何理解provide和inject?直接看代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父级组件提供 'foo' 给所有子组件</span></span><br><span class="line"><span class="keyword">var</span> Provider = &#123;</span><br><span class="line">  provide: &#123;</span><br><span class="line">    foo: <span class="string">'bar'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件注入 'foo'</span></span><br><span class="line"><span class="keyword">var</span> Child = &#123;</span><br><span class="line">  inject: [<span class="string">'foo'</span>],</span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo) <span class="comment">// =&gt; "bar"</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><i style="color:'red'"><code>provide</code> 和 <code>inject</code> 主要为高阶插件/组件库提供用例。并不推荐直接用于应用程序代码中</i></p>
<p>他们的局限在于，多用于子组件获取父组件的状态，对于父子组件的通信就不适用。对此，见下文。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/组件开发流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/组件开发流程/" itemprop="url">基础组件开发二三事</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Keys"><a href="#Keys" class="headerlink" title="Keys"></a>Keys</h3><h4 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h4> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vue create my-project</span><br><span class="line">yarn add vue-router // 安装router</span><br><span class="line">yarn add async-validator // 常用的校验库</span><br></pre></td></tr></table></figure>
<h4 id="项目结构调整"><a href="#项目结构调整" class="headerlink" title="项目结构调整"></a>项目结构调整</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">++ src</span><br><span class="line">++++ assets --静态资源，如图片等</span><br><span class="line">++++ components </span><br><span class="line">++++++form   </span><br><span class="line">++++++++form.vue</span><br><span class="line">++++++++form-item.vue</span><br><span class="line">++++++input</span><br><span class="line">++++++++input.vue</span><br><span class="line">++++ mixins --用来混入</span><br><span class="line">++++++emmiter.js --实现dispatch和broadcast</span><br><span class="line">++++ views</span><br><span class="line">++++++Form.vue</span><br><span class="line">++++ main.js</span><br><span class="line">++++ App.vue</span><br><span class="line">++++ router.js --路由</span><br></pre></td></tr></table></figure>
<h4 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a>router.js</h4><p>推荐使用组件按需加载的方式，也就是懒加载，可以节省页面初始化的时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      name: <span class="string">'home'</span>,</span><br><span class="line">      component: Home</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/form'</span>,</span><br><span class="line">      name: <span class="string">'form'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span>=&gt;</span><span class="keyword">import</span>(<span class="string">'./views/Form.vue'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="mixin写法"><a href="#mixin写法" class="headerlink" title="mixin写法"></a>mixin写法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">'../../test.js'</span> <span class="comment">//混入make方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    mixins: [test],</span><br><span class="line">    methods:&#123;</span><br><span class="line">        <span class="keyword">this</span>.make()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="父子组件通信"><a href="#父子组件通信" class="headerlink" title="父子组件通信"></a>父子组件通信</h4><ul>
<li>通过自定义的dispatch和broadcast传递事件</li>
<li>在组件中通过$on监听被触发的事件</li>
<li>组件渲染顺序是从内到外的，子组件的mounted在父组件的mounted之前，在父组件的created之后。所以，应该在父组件的created里面监听事件。</li>
<li>如果只是单纯的传递数据，状态等，可以结合实际，考虑使用provide/inject（可以给所有子组件通过注入的方式使用，类似vux) 和 props(一级一级的传)</li>
</ul>
<h4 id="常用易混淆的JS方法"><a href="#常用易混淆的JS方法" class="headerlink" title="常用易混淆的JS方法"></a>常用易混淆的JS方法</h4><ul>
<li><p>filter forEach every</p>
<ul>
<li>every()是对数组中的每一项运行给定函数，如果该函数对每一项都返回true，则返回true。</li>
<li>some()是对数组中的每一项运行给定函数，如果该函数对任一项返回true，则返回true。</li>
<li>filter()是对数组中的每一项运行给定函数，返回该函数会返回true的项所组成的数组。</li>
<li>forEach() 是多数组中的每一项运行给定函数，这个方法没有返回值。它只是对数组中的每一项运行传入的函数，没有返回值。本质上与使用for循环迭代数组一样。</li>
</ul>
</li>
<li><p>apply call bind</p>
<p>call 和 apply 都是为了改变某个函数运行时的上下文（context）而存在的，换句话说，就是为了改变函数体内部 this 的指向。</p>
<p><strong>立即执行</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func.call(<span class="keyword">this</span>, arg1, arg2);</span><br><span class="line">func.apply(<span class="keyword">this</span>, [arg1, arg2]);</span><br></pre></td></tr></table></figure>
<p><code>bind()</code>最简单的用法是创建一个函数，使这个函数不论怎么调用都有同样的this值。</p>
<p><strong>不立即执行，只是创建一个函数</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> boundGetNum = getNum.bind(mymodule);</span><br><span class="line">boundGetNum();</span><br></pre></td></tr></table></figure>
</li>
<li><p>AsyncValidator的使用</p>
</li>
</ul>
<h4 id="async-validator"><a href="#async-validator" class="headerlink" title="async-validator"></a>async-validator</h4><p>异步验证，需要传入验证的规则和需要验证的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证的规则</span></span><br><span class="line">ruleValidate: &#123;</span><br><span class="line">  name: [</span><br><span class="line">     &#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">"用户名不能为空"</span>, <span class="attr">trigger</span>: <span class="string">"blur"</span> &#125;,</span><br><span class="line">     &#123; <span class="attr">type</span>:<span class="string">'email'</span>, <span class="attr">message</span>:<span class="string">'必须为邮箱格式'</span>, <span class="attr">trigger</span>: <span class="string">"blur"</span> &#125;</span><br><span class="line">    ],      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要验证的数据格式</span></span><br><span class="line">&#123;</span><br><span class="line">    a: xxx,</span><br><span class="line">    b: xxx</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证的通用代码</span></span><br><span class="line"><span class="keyword">let</span> descriptor = &#123;&#125;;</span><br><span class="line">descriptor[<span class="keyword">this</span>.prop] = rule; <span class="comment">// descriptor['name']</span></span><br><span class="line"><span class="keyword">const</span> validator = <span class="keyword">new</span> AsyncValidator(descriptor);  <span class="comment">// 封装验证器</span></span><br><span class="line"><span class="keyword">let</span> model = &#123;&#125;;</span><br><span class="line">model[<span class="keyword">this</span>.prop] = <span class="keyword">this</span>.filedValue; <span class="comment">// 封装验证的数据</span></span><br><span class="line">validator.validate(model, &#123; <span class="attr">firstFields</span>: <span class="literal">true</span> &#125;, errors =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.validateState = !errors ? <span class="string">'success'</span> : <span class="string">'error'</span>;</span><br><span class="line">      <span class="keyword">this</span>.validateMessage = errors ? errors[<span class="number">0</span>].message : <span class="string">''</span>;</span><br><span class="line">      callback(<span class="keyword">this</span>.validateMessage); <span class="comment">// callback是回调函数</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="调用子组件的方法"><a href="#调用子组件的方法" class="headerlink" title="调用子组件的方法"></a>调用子组件的方法</h4><p>给子组件一个ref = ‘test’</p>
<p>this.$refs.test.方法()</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/更快加载HTML页面的一些策略/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/更快加载HTML页面的一些策略/" itemprop="url">如何更快加载HTML页面</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="减少页面的大小"><a href="#减少页面的大小" class="headerlink" title="减少页面的大小"></a>减少页面的大小</h3><p>排除不必要的空格，注释，内嵌脚本等。</p>
<h3 id="最小化文件数量"><a href="#最小化文件数量" class="headerlink" title="最小化文件数量"></a>最小化文件数量</h3><p>减少文件引用的数量，也就是降低http请求次数。</p>
<h3 id="减少域名查找"><a href="#减少域名查找" class="headerlink" title="减少域名查找"></a>减少域名查找</h3><p>每个独立的域名都会耗费DNS查找时间，所以在页面中尽量少的使用来自不同域名的地址</p>
<h3 id="缓存重用的内容"><a href="#缓存重用的内容" class="headerlink" title="缓存重用的内容"></a>缓存重用的内容</h3><p>确保会被多次使用的内容被缓存，下次加载减少渲染时间</p>
<h3 id="高效排列页面组件"><a href="#高效排列页面组件" class="headerlink" title="高效排列页面组件"></a>高效排列页面组件</h3><p>页面最初显示时，会先下载页面内容和所需的js以及css。而页面中具有动态特性的资源需要在页面完全加载之后，才会被使用。所以，最好在初始化时关闭动态特性（disable dynamic features ），等页面加载完后再打开它。这样JavaScript就会在网页内容之后才加载，有助于提升页面加载的整体表现。</p>
<h3 id="减少内联脚本"><a href="#减少内联脚本" class="headerlink" title="减少内联脚本"></a>减少内联脚本</h3><h3 id="使用CSS和合法标志"><a href="#使用CSS和合法标志" class="headerlink" title="使用CSS和合法标志"></a>使用CSS和合法标志</h3><h3 id="给内容分块"><a href="#给内容分块" class="headerlink" title="给内容分块"></a>给内容分块</h3><h3 id="指定图像和表格的大小"><a href="#指定图像和表格的大小" class="headerlink" title="指定图像和表格的大小"></a>指定图像和表格的大小</h3><h3 id="合理选择user-agent"><a href="#合理选择user-agent" class="headerlink" title="合理选择user-agent"></a>合理选择user-agent</h3><h3 id="尽量使用async和defer"><a href="#尽量使用async和defer" class="headerlink" title="尽量使用async和defer"></a>尽量使用async和defer</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">没有 defer 或 async，浏览器会立即加载并执行指定的脚本，不等待后续载入的文档元素，读到就加载并执行 </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"script.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">加载和渲染后续文档元素的过程将和 script.js 的加载与执行并行进行（异步）</span></span><br><span class="line"><span class="comment">async的执行，并不会按着script在页面中的顺序来执行，而是谁先加载完谁执行。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">"script.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">有defer，加载后续文档元素的过程将和 script.js 的加载并行进行（异步），但是 script.js 的执行要在所有元素解析完成之后，DOMContentLoaded 事件触发之前完成。</span></span><br><span class="line"><span class="comment">如果有多个设置了defer的script标签存在，则会按照顺序执行所有的script；</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">"myscript.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/jiasm/p/7683930.html" target="_blank" rel="noopener">更多相关见本链接</a></p>
<h3 id="页面结构示例"><a href="#页面结构示例" class="headerlink" title="页面结构示例"></a>页面结构示例</h3><p>HEAD<br>     LINK …<br>    CSS 文件用来修饰页面外观。在调试维护中把不相关的 CSS 拆分在不同文件中，且尽量减少文件的数量可以提高性能。<br>    SCRIPT …<br>    JavaScript 文件用来实现页面加载时的一些功能，但不是所有的 DHTML 在页面加载后才能运行。<br>在调试维护中把不相关的 JavaScript 拆分在不同文件中，且尽量减少文件的数量可以提高性能。<br>· BODY<br>  在一块组件（tables / divs）中用户可见的页面内容，不必等页面完全加载也能显出来的。<br>    SCRIPT …<br>        被用来支持动态页面（DHTML）展示的脚本。</p>
<p>DHTML 脚本通常在页面完全加载或者所有必要的对象（objects）已初始化完毕之后才能运行。没有必要在页面内容之前加载这些脚本，这只会拖慢页面加载和初始化的体验。<br>在调试维护中把不相关的 script 拆分在不同文件中，且尽量减少文件的数量可以提高性能。<br>如有图像用到了反转效果，你应该在页面内容下载完后预加载这些图像。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/vue-源码学习总结(一)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/vue-源码学习总结(一)/" itemprop="url">vuejs运用机制概览</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h4><p>在断断续续做过一段时间的vue项目之后，不久又掘金上看到的vue学习小册，简单浏览一遍，受益良多。所以简单的通过摘录，笔记的形式，边学习便记忆，加深自己对vue原理的理解，并帮助自己日后进一步的研究vue的源码。</p>
<h2 id="总览vue"><a href="#总览vue" class="headerlink" title="总览vue"></a>总览vue</h2><p><img src="/img/vue" alt="内部流程图"></p>
<h3 id="初始化和加载"><a href="#初始化和加载" class="headerlink" title="初始化和加载"></a>初始化和加载</h3><p><img src="/img/vue_1" alt="初始化及加载"></p>
<p>在 new Vue() 之后，会调用 vue._init() 函数进行初始化，包括生成生命周期，事件，props, data, methods, computed, watch 等等。</p>
<p>最主要的是通过Object.defineProperty设置setter和getter函数，实现响应式和依赖采集；</p>
<p>初始化之后，通过$mount 挂载组件，存在template时，需要进行编译。</p>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p><img src="/img/vue_2" alt="编译"></p>
<ol>
<li><p>parse阶段</p>
<p>借助正则表达式解析template中的css,class,style,指令等，生成AST</p>
</li>
<li><p>optimize阶段</p>
<p>标记静态节点，这样以后update页面需要通过patch来比较渲染dom的时候，会跳过静态节点，从而减少比较的时间，提升patch的性能，对编译过程实现优化。</p>
</li>
<li><p>generate阶段</p>
<p>将AST转换为render function字符串等。</p>
</li>
</ol>
<p>经过以上三个阶段之后，组件中就会存在渲染VNode节点需要的函数。</p>
<h3 id="响应式"><a href="#响应式" class="headerlink" title="响应式"></a>响应式</h3><p><img src="/img/vue_3" alt="响应式"></p>
<p>在初始化阶段，我们设置了getter和setter方法，分别在读取和赋值的时候触发。</p>
<p>渲染组件的时候，会进行读取操作，触发getter函数，实现依赖收集，将观察者watcher收集放入当前闭包的订阅者Dep里面；</p>
<p>对组件进行修改时，会触发setter函数，setter会通知之前收集的所有观察者，让他们重新渲染视图。在渲染过程中，有用到update和patch等。</p>
<h3 id="Virtual-DOM"><a href="#Virtual-DOM" class="headerlink" title="Virtual DOM"></a>Virtual DOM</h3><p>render function 生成 vNode 节点，这些节点组成 vDom(js对真实DOM的抽象)</p>
<h3 id="更新视图"><a href="#更新视图" class="headerlink" title="更新视图"></a>更新视图</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/let-和-const/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/let-和-const/" itemprop="url">let 和 const</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="let-命令"><a href="#let-命令" class="headerlink" title="let 命令"></a>let 命令</h3><h4 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h4><p>let 变量的作用域是在其对应的代码块，var 的变量是全局变量，会挂载在顶层变量上。</p>
<p>对于for循环，设置循环变量的作用域是父作用域，循环体内部是单独的子作用域。同名变量在子作用域会覆盖父作用域传来的值,但是在父作用域对应变量值不受影响。具体如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">let</span> i =<span class="string">'abc'</span></span><br><span class="line">    <span class="built_in">console</span>.log(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//abc</span></span><br><span class="line"><span class="comment">//abc</span></span><br><span class="line"><span class="comment">//abc</span></span><br></pre></td></tr></table></figure>
<h4 id="变量提升"><a href="#变量提升" class="headerlink" title="变量提升"></a>变量提升</h4><p>对于用let和const声明的变量不会发生变量提升，而使用var会发生变量提升。所以，var变量在声明前使用不报错，而let和const会报错。</p>
<p>变量提升：js从上到下执行时，分为词法分析和执行两个阶段。在词法分析阶段，包括分析形参，分析变量，分析函数声明三个部分。经过词法分析后，会将存在的变量声明和函数声明，进行一番处理，比如赋值等。具体代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a)</span><br><span class="line"><span class="keyword">var</span> a =<span class="number">12</span></span><br></pre></td></tr></table></figure>
<p>词法分析后的代码为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="literal">undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br><span class="line">a=<span class="number">12</span></span><br></pre></td></tr></table></figure>
<p>运行的结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">undefined</span><br></pre></td></tr></table></figure>
<h4 id="暂时性死去TDZ"><a href="#暂时性死去TDZ" class="headerlink" title="暂时性死去TDZ"></a>暂时性死去TDZ</h4><p>由于let/const不会变量提升，在作用域内，变量声明之前的部分，对于该变量都属于死区，也就是暂时性死区。</p>
<p>TDZ导致typeof运算符不再安全，当在变量X的暂时性死区中使用typeof检验X时，此时会抛出ReferenceError。</p>
<h4 id="不允许重复声明"><a href="#不允许重复声明" class="headerlink" title="不允许重复声明"></a>不允许重复声明</h4><h3 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h3><p>使用{ 和 } 包裹的作用域</p>
<h3 id="let-amp-const"><a href="#let-amp-const" class="headerlink" title="let &amp; const"></a>let &amp; const</h3><p>const声明只读变量，必须赋值，一旦声明就不能改变它的值。但是如果声明的是个对象时，可以改变对象的属性值。本质上，不可改变的是指针指向的对象，或者说内存地址所保存的数据不得改动。对于字符串，数字等简单变量，内存地址保存的就是它的值，但是对于对象，数组等保存的是指向数据的地指针。</p>
<p>const变量的作用域只在声明的块作用域有效，没有变量提升，有TDZ.</p>
<h4 id="冻结对象"><a href="#冻结对象" class="headerlink" title="冻结对象"></a>冻结对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="built_in">Object</span>.freeze(&#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常规模式时，下面一行不起作用；</span></span><br><span class="line"><span class="comment">// 严格模式时，该行会报错</span></span><br><span class="line">foo.prop = <span class="number">123</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将对象本身冻结，对象的属性也冻结</span></span><br><span class="line"><span class="keyword">var</span> constantize = <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">Object</span>.freeze(obj);</span><br><span class="line">  <span class="built_in">Object</span>.keys(obj).forEach( <span class="function">(<span class="params">key, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">typeof</span> obj[key] === <span class="string">'object'</span> ) &#123;</span><br><span class="line">      constantize( obj[key] );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="声明变量6种方式"><a href="#声明变量6种方式" class="headerlink" title="声明变量6种方式"></a>声明变量6种方式</h4><ul>
<li>var</li>
<li>function</li>
<li>let</li>
<li>const</li>
<li>class</li>
<li>import</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://flybids.github.io/2019/08/01/vuejs拾遗/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huang Gang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Redo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/01/vuejs拾遗/" itemprop="url">vuejs基础拾遗（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-01T09:35:46+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h3><p>在学习并使用vue框架开发了几个项目后，发现自己对vue的一些基本属性和概念有所疏漏。闲暇之余，便重拾vue官网文档，见有不熟悉之处，便摘录余下。以后时有更删。</p>
<h3 id="Vue实例"><a href="#Vue实例" class="headerlink" title="Vue实例"></a>Vue实例</h3><h4 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new Vue(&#123;&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="数据与方法"><a href="#数据与方法" class="headerlink" title="数据与方法"></a>数据与方法</h4><p>可以使用Object.freeze()冻结一个对象，使对象的属性无法被修改，但是响应式系统也无法追踪变化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;foo : &apos;bar&apos;&#125;</span><br><span class="line">Object.freeze(obj)</span><br><span class="line">new Vue(&#123;el:&apos;#app&apos;, data:obj&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><ul>
<li>生命周期函数不建议使用箭头函数，否则会有this的指向问题</li>
<li>生命周期<ol>
<li>beforeCreate</li>
<li>created</li>
<li>beforeMount</li>
<li>mounted</li>
<li>beforeUpdate</li>
<li>updated</li>
<li>beforeDestroy</li>
<li>destroyed</li>
</ol>
</li>
</ul>
<h3 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h3><h4 id="插值"><a href="#插值" class="headerlink" title="插值"></a>插值</h4><ul>
<li><p>原始HTML,把插值按照HTML进行解析</p>
<p>动态渲染任意HTML比较危险，容易导致xss攻击。<strong>只对可信内容使用HTML插值，绝不对用户提供的内容使用插值</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">    Using: &lt;span v-html=&quot;rawHtml&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用v-once指令，一次性插值，当数据更新时，插值处的内容不更新。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span v-once&gt;&#123;&#123; msg &#125;&#125;&lt;/span&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h4><ul>
<li>v-if  </li>
<li>v-show</li>
<li>v-bind  等同于 :  绑定值</li>
<li>v-on 等同于@ 绑定dom事件</li>
</ul>
<h3 id="计算属性和侦听器"><a href="#计算属性和侦听器" class="headerlink" title="计算属性和侦听器"></a>计算属性和侦听器</h3><h4 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h4><ul>
<li><p>对于任何复杂逻辑，都应当使用计算属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">    &#123;&#123; reverseMsg &#125;&#125;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">el:&apos;#example&apos;,</span><br><span class="line">data:&#123;</span><br><span class="line">msg: &apos;Hello&apos;</span><br><span class="line">&#125;,</span><br><span class="line">computed:&#123;</span><br><span class="line">reverseMsg: function()&#123;</span><br><span class="line">return this.msg.split(&apos;&apos;).reverse().join(&apos;&apos;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>vs methods</p>
<p>computed中的方法动态绑定相关的值，如上述的msg.当msg变化时，会重新执行渲染。同时，只要msg没有变化，即便多次使用reverseMsg也不会重复执行多次reverseMsg，相当于缓存。</p>
</li>
<li><p>vs watch</p>
<p>可以使用computed的话，就不要使用watch.使用watch可能代码重复等。</p>
</li>
<li><p>setter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">  fullName: &#123;</span><br><span class="line">    // getter</span><br><span class="line">    get: function () &#123;</span><br><span class="line">      return this.firstName + &apos; &apos; + this.lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    // setter</span><br><span class="line">    set: function (newValue) &#123;</span><br><span class="line">      var names = newValue.split(&apos; &apos;)</span><br><span class="line">      this.firstName = names[0]</span><br><span class="line">      this.lastName = names[names.length - 1]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="侦听器"><a href="#侦听器" class="headerlink" title="侦听器"></a>侦听器</h4><p>当需要在数据变化时执行异步或开销较大的操作时，这个方式是最有用的。除了 <code>watch</code> 选项之外，您还可以使用命令式的 <a href="https://cn.vuejs.org/v2/api/#vm-watch" target="_blank" rel="noopener">vm.$watch API</a>。</p>
</li>
</ul>
<h3 id="Class与Style绑定"><a href="#Class与Style绑定" class="headerlink" title="Class与Style绑定"></a>Class与Style绑定</h3><h4 id="绑定HTML-Class"><a href="#绑定HTML-Class" class="headerlink" title="绑定HTML Class"></a>绑定HTML Class</h4><ul>
<li><p>对象语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:class=&quot;classObject&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">data: &#123;</span><br><span class="line">  isActive: true,</span><br><span class="line">  error: null</span><br><span class="line">&#125;,</span><br><span class="line">computed: &#123;</span><br><span class="line">  classObject: function () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      active: this.isActive &amp;&amp; !this.error,</span><br><span class="line">      &apos;text-danger&apos;: this.error &amp;&amp; this.error.type === &apos;fatal&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .active&#123;&#125;</span><br><span class="line">    .text-danger&#123;&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:class=&quot;[activeClass, errorClass]&quot;&gt;&lt;/div&gt;</span><br><span class="line">data: &#123;</span><br><span class="line">  activeClass: &apos;active&apos;,</span><br><span class="line">  errorClass: &apos;text-danger&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>渲染为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"active text-danger"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>用在组件上</p>
<p>当在一个自定义组件上使用 <code>class</code> 属性时，这些类将被添加到该组件的根元素上面。这个元素上已经存在的类不会被覆盖。</p>
</li>
</ul>
<h4 id="绑定内联样式"><a href="#绑定内联样式" class="headerlink" title="绑定内联样式"></a>绑定内联样式</h4><ul>
<li><p>对象语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:style=&quot;&#123; color: activeColor, fontSize: fontSize + &apos;px&apos; &#125;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">data: &#123;</span><br><span class="line">  activeColor: &apos;red&apos;,</span><br><span class="line">  fontSize: 30</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>更推荐：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:style=&quot;styleObject&quot;&gt;&lt;/div&gt;</span><br><span class="line">data: &#123;</span><br><span class="line">  styleObject: &#123;</span><br><span class="line">    color: &apos;red&apos;,</span><br><span class="line">    fontSize: &apos;13px&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组语法</p>
<p>将多个样式对象应用到同一个元素上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:style=&quot;[baseStyles, overridingStyles]&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自动添加前缀</p>
<p>当 <code>v-bind:style</code> 使用需要添加<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Vendor_Prefix" target="_blank" rel="noopener">浏览器引擎前缀</a>的 CSS 属性时，如 <code>transform</code>，Vue.js 会<strong>自动侦测并添加相应的前缀</strong>。</p>
</li>
<li><p>多重值</p>
<p>v2.3.0+</p>
<p>为 <code>style</code> 绑定中的属性提供一个包含多个值的数组，常用于提供多个带前缀的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div :style=&quot;&#123; display: [&apos;-webkit-box&apos;, &apos;-ms-flexbox&apos;, &apos;flex&apos;] &#125;&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>在本例中，如果浏览器支持不带浏览器前缀的 flexbox，那么就只会渲染 <code>display: flex</code>。</p>
</li>
</ul>
<h3 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h3><h4 id="v-if-vs-v-show"><a href="#v-if-vs-v-show" class="headerlink" title="v-if vs v-show"></a>v-if vs v-show</h4><ul>
<li><p>v-if</p>
<p><code>v-if</code> 是“真正”的条件渲染，因为它会确保在切换过程中条件块内的事件监听器和子组件适当地被销毁和重建。</p>
<p><code>v-if</code> 也是<strong>惰性的</strong>：如果在初始渲染时条件为假，则什么也不做——直到条件第一次变为真时，才会开始渲染条件块。</p>
</li>
<li><p>v-show</p>
<p>不管初始条件是什么，元素总是会被渲染，并且只是简单地基于 CSS 进行切换。</p>
</li>
<li><p>如何选择</p>
<p><code>v-if</code> 有更高的切换开销，而 <code>v-show</code> 有更高的初始渲染开销。因此，如果需要非常频繁地切换，则使用 <code>v-show</code> 较好；如果在运行时条件很少改变，则使用 <code>v-if</code> 较好。</p>
</li>
</ul>
<h4 id="不推荐同时使用-v-if-v-for"><a href="#不推荐同时使用-v-if-v-for" class="headerlink" title="不推荐同时使用 v-if v-for"></a>不推荐同时使用 v-if v-for</h4><p><code>v-for</code> 具有比 <code>v-if</code> 更高的优先级</p>
<h3 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h3><h4 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h4><ol>
<li>v-for = “item in items”</li>
<li>v-for = “item of items”</li>
</ol>
<p>可以遍历对象和数组，在遍历对象时，是按 <code>Object.keys()</code> 的结果遍历，但是不能保证它的结果在不同的 JavaScript 引擎下是一致的。</p>
<h4 id="对象更改检测注意事项"><a href="#对象更改检测注意事项" class="headerlink" title="对象更改检测注意事项"></a>对象更改检测注意事项</h4><p>由于 JavaScript 的限制，<strong>Vue 不能检测对象属性的添加或删除</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    userProfile: &#123;</span><br><span class="line">      name: &apos;Anika&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>对于已经创建的实例，Vue 不能动态添加根级别的响应式属性。但是，可以使用 <code>Vue.set(object, key, value)</code> 方法向嵌套对象添加响应式属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vue.set(vm.userProfile, &apos;age&apos;, 27)</span><br></pre></td></tr></table></figure>
<p>你还可以使用 <code>vm.$set</code> 实例方法，它只是全局 <code>Vue.set</code> 的别名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.$set(vm.userProfile, &apos;age&apos;, 27)</span><br></pre></td></tr></table></figure>
<h4 id="过滤和排序"><a href="#过滤和排序" class="headerlink" title="过滤和排序"></a>过滤和排序</h4><p>有时，我们想要显示一个数组的过滤或排序副本，而不实际改变或重置原始数据。在这种情况下，可以创建返回过滤或排序数组的计算属性。</p>
<p>在计算属性不适用的情况下 (例如，在嵌套 <code>v-for</code> 循环中) 你可以使用一个 method 方法。</p>
<h4 id="一段取值范围"><a href="#一段取值范围" class="headerlink" title="一段取值范围"></a>一段取值范围</h4><p><code>v-for</code> 也可以取整数。在这种情况下，它将重复多次模板。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;span v-for=&quot;n in 10&quot;&gt;&#123;&#123; n &#125;&#125; &lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>渲染为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 2 3 4 5 6 7 8 9 10</span><br></pre></td></tr></table></figure>
<h4 id="v-for-on-a"><a href="#v-for-on-a" class="headerlink" title="v-for on a \"></a>v-for on a \<template></template></h4><p>类似于 <code>v-if</code>，你也可以利用带有 <code>v-for</code> 的 <code>&lt;template&gt;</code> 渲染多个元素。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;template v-for=&quot;item in items&quot;&gt;</span><br><span class="line">    &lt;li&gt;&#123;&#123; item.msg &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &lt;li class=&quot;divider&quot; role=&quot;presentation&quot;&gt;&lt;/li&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Huang Gang</p>
              <p class="site-description motion-element" itemprop="description">flybid's blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huang Gang</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
